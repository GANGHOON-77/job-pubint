<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; font-weight: bold; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .job-item { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px; background: #fafafa; }
        .job-title { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 10px; }
        .job-company { color: #666; font-size: 16px; margin-bottom: 8px; }
        .job-details { font-size: 14px; color: #888; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏛️ Firebase 채용정보 테스트</h1>
        
        <div id="status" class="status info">연결 중...</div>
        
        <div id="data-count" class="status info">데이터 확인 중...</div>
        
        <div id="jobs-container"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, limit, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase 설정 - 임시 테스트용
        const firebaseConfig = {
            apiKey: "AIzaSyDvhF0qR3X8G7K5mNp9QwE2rT6yU1oI4sA", // 테스트용 키
            authDomain: "job-pubint.firebaseapp.com",
            projectId: "job-pubint",
            storageBucket: "job-pubint.appspot.com",
            messagingSenderId: "738419891043",
            appId: "1:738419891043:web:4f5g6h7i8j9k0l1m2n3o4p5q"
        };

        const statusEl = document.getElementById('status');
        const countEl = document.getElementById('data-count');
        const jobsEl = document.getElementById('jobs-container');

        async function testFirebaseConnection() {
            try {
                // Firebase 초기화
                console.log('Firebase 초기화 시작...');
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                statusEl.textContent = '✅ Firebase 초기화 성공';
                statusEl.className = 'status success';
                
                // 컬렉션에서 데이터 읽기 시도
                console.log('데이터 읽기 시작...');
                const jobsRef = collection(db, 'recruitment_jobs');
                
                // 단순 조회 (제한 없이)
                const snapshot = await getDocs(jobsRef);
                
                console.log(`총 ${snapshot.size}개 문서 발견`);
                countEl.textContent = `📊 총 ${snapshot.size}개 채용공고 발견`;
                countEl.className = 'status success';
                
                // 처음 10개만 표시
                let count = 0;
                snapshot.forEach((doc) => {
                    if (count < 10) {
                        const data = doc.data();
                        
                        const jobDiv = document.createElement('div');
                        jobDiv.className = 'job-item';
                        jobDiv.innerHTML = `
                            <div class="job-title">${data.recruit_title || '제목 없음'}</div>
                            <div class="job-company">🏢 ${data.inst_nm || '기관명 없음'}</div>
                            <div class="job-details">
                                📍 ${data.work_region || '지역 정보 없음'} | 
                                👥 ${data.recruit_person_cnt || '인원 미정'} |
                                📅 ${data.rcept_end_date || '기한 없음'}
                            </div>
                        `;
                        jobsEl.appendChild(jobDiv);
                        count++;
                    }
                });
                
                if (snapshot.size === 0) {
                    jobsEl.innerHTML = '<div class="status error">저장된 채용공고가 없습니다.</div>';
                }
                
            } catch (error) {
                console.error('Firebase 오류:', error);
                statusEl.textContent = `❌ 연결 실패: ${error.message}`;
                statusEl.className = 'status error';
                
                // 상세 오류 정보
                countEl.textContent = `오류 코드: ${error.code || '알 수 없음'}`;
                countEl.className = 'status error';
                
                // 일반적인 Firebase 오류들에 대한 안내
                let suggestion = '';
                if (error.code === 'permission-denied') {
                    suggestion = '💡 Firebase 보안 규칙이 읽기를 차단하고 있습니다. Firestore 규칙을 확인하세요.';
                } else if (error.code === 'not-found') {
                    suggestion = '💡 컬렉션이나 문서를 찾을 수 없습니다.';
                } else if (error.code === 'invalid-api-key') {
                    suggestion = '💡 API 키가 잘못되었습니다. Firebase 설정을 확인하세요.';
                }
                
                if (suggestion) {
                    jobsEl.innerHTML = `<div class="status info">${suggestion}</div>`;
                }
            }
        }

        // 페이지 로드 시 테스트 실행
        testFirebaseConnection();
    </script>
</body>
</html>