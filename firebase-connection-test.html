<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ - job-pubint</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f6fa 0%, #e8eaf0 100%);
        }
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1565c0 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        .config-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .config-section h2 {
            color: #1e3a8a;
            margin-top: 0;
            margin-bottom: 20px;
        }
        .config-input {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e4e7;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .config-input:focus {
            border-color: #1e3a8a;
            outline: none;
        }
        .button {
            background: linear-gradient(135deg, #1e3a8a 0%, #1565c0 100%);
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px 10px 10px 0;
            transition: transform 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
        }
        .button:active {
            transform: translateY(0);
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }
        .data-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
        }
        .job-item {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid #1e3a8a;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .job-item h3 {
            color: #1e3a8a;
            margin-bottom: 10px;
        }
        .job-item .meta {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 8px;
        }
        .help-section {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .help-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }
        .help-section ol {
            color: #856404;
            line-height: 1.8;
        }
        .help-section a {
            color: #1e3a8a;
            font-weight: 600;
        }
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .project-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .project-info h3 {
            color: #1e3a8a;
            margin-bottom: 10px;
        }
        .project-info .code {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            display: inline-block;
            font-weight: bold;
            color: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”¥ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
        <p>í”„ë¡œì íŠ¸: job-pubint</p>
    </div>

    <div class="project-info">
        <h3>ğŸ“‹ í”„ë¡œì íŠ¸ ì •ë³´</h3>
        <p><strong>í”„ë¡œì íŠ¸ ID:</strong> <span class="code">job-pubint</span></p>
        <p><strong>ì„œë¹„ìŠ¤ ê³„ì •:</strong> <span class="code">firebase-adminsdk-fbsvc@job-pubint.iam.gserviceaccount.com</span></p>
    </div>

    <div class="config-section">
        <h2>âš™ï¸ Firebase ì›¹ ì•± ì„¤ì •</h2>
        <p>Firebase Console â†’ í”„ë¡œì íŠ¸ ì„¤ì • â†’ ì›¹ ì•±ì—ì„œ ì„¤ì •ê°’ì„ ë³µì‚¬í•˜ì„¸ìš”</p>
        
        <label><strong>API Key:</strong></label>
        <input type="text" id="apiKey" class="config-input" placeholder="AIzaSy..." value="">
        
        <label><strong>Auth Domain:</strong></label>
        <input type="text" id="authDomain" class="config-input" placeholder="job-pubint.firebaseapp.com" value="job-pubint.firebaseapp.com">
        
        <label><strong>Project ID:</strong></label>
        <input type="text" id="projectId" class="config-input" value="job-pubint" readonly>
        
        <label><strong>Storage Bucket:</strong></label>
        <input type="text" id="storageBucket" class="config-input" placeholder="job-pubint.appspot.com" value="job-pubint.appspot.com">
        
        <label><strong>Messaging Sender ID:</strong></label>
        <input type="text" id="messagingSenderId" class="config-input" placeholder="123456789" value="">
        
        <label><strong>App ID:</strong></label>
        <input type="text" id="appId" class="config-input" placeholder="1:123456789:web:abc123" value="">
        
        <button class="button" onclick="testConnection()">ğŸ”Œ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <button class="button" onclick="saveConfig()">ğŸ’¾ ì„¤ì • ì €ì¥</button>
        <button class="button" onclick="loadSavedConfig()">ğŸ“‚ ì €ì¥ëœ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="button" onclick="createSampleData()">ğŸ“ ìƒ˜í”Œ ë°ì´í„° ìƒì„±</button>
    </div>

    <div class="config-section">
        <h2>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
        <div id="status"></div>
        <div id="dataDisplay"></div>
    </div>

    <div class="help-section">
        <h3>ğŸ’¡ ì„¤ì • ê°€ì´ë“œ</h3>
        <ol>
            <li><strong>Firebase Console ì ‘ì†:</strong> <a href="https://console.firebase.google.com/project/job-pubint/settings/general" target="_blank">í”„ë¡œì íŠ¸ ì„¤ì • í˜ì´ì§€</a></li>
            <li><strong>ì›¹ ì•± ì¶”ê°€:</strong> "ì•± ì¶”ê°€" â†’ "ì›¹" ì„ íƒ (ì•„ì§ ì—†ë‹¤ë©´)</li>
            <li><strong>ì„¤ì • ë³µì‚¬:</strong> firebaseConfig ê°ì²´ì˜ ê° ê°’ì„ ìœ„ ì…ë ¥ë€ì— ë¶™ì—¬ë„£ê¸°</li>
            <li><strong>Firestore í™œì„±í™”:</strong> <a href="https://console.firebase.google.com/project/job-pubint/firestore" target="_blank">Firestore í˜ì´ì§€</a>ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±</li>
            <li><strong>ë³´ì•ˆ ê·œì¹™ (í…ŒìŠ¤íŠ¸ìš©):</strong>
                <pre>rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}</pre>
            </li>
        </ol>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, addDoc, limit, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        let app = null;
        let db = null;
        
        // ì €ì¥ëœ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        window.loadSavedConfig = function() {
            const saved = localStorage.getItem('firebaseConfig_job_pubint');
            if (saved) {
                const config = JSON.parse(saved);
                document.getElementById('apiKey').value = config.apiKey || '';
                document.getElementById('authDomain').value = config.authDomain || '';
                document.getElementById('projectId').value = config.projectId || '';
                document.getElementById('storageBucket').value = config.storageBucket || '';
                document.getElementById('messagingSenderId').value = config.messagingSenderId || '';
                document.getElementById('appId').value = config.appId || '';
                showStatus('info', 'ğŸ’¾ ì €ì¥ëœ ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
            } else {
                showStatus('error', 'âŒ ì €ì¥ëœ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì„¤ì • ì €ì¥
        window.saveConfig = function() {
            const config = {
                apiKey: document.getElementById('apiKey').value,
                authDomain: document.getElementById('authDomain').value,
                projectId: document.getElementById('projectId').value,
                storageBucket: document.getElementById('storageBucket').value,
                messagingSenderId: document.getElementById('messagingSenderId').value,
                appId: document.getElementById('appId').value
            };
            localStorage.setItem('firebaseConfig_job_pubint', JSON.stringify(config));
            showStatus('success', 'ğŸ’¾ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ìƒ˜í”Œ ë°ì´í„° ìƒì„±
        window.createSampleData = async function() {
            if (!db) {
                showStatus('error', 'âŒ ë¨¼ì € Firebaseì— ì—°ê²°í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                showStatus('info', 'ğŸ“ ìƒ˜í”Œ ë°ì´í„° ìƒì„± ì¤‘...');
                
                const sampleJobs = [
                    {
                        inst_nm: 'í•œêµ­ì‚¬íšŒë³´ì¥ì •ë³´ì›',
                        recruit_title: '2024ë…„ ìƒë°˜ê¸° ì‹ ì…ì§ì› ì±„ìš©',
                        work_region: 'ì„œìš¸',
                        recruit_person_cnt: '5',
                        inst_type_nm: 'ê³µê³µê¸°ê´€',
                        rcept_end_date: '2024-12-31',
                        reg_date: new Date().toISOString(),
                        status: 'active',
                        created_at: new Date(),
                        updated_at: new Date()
                    },
                    {
                        inst_nm: 'êµ­ë¯¼ê±´ê°•ë³´í—˜ê³µë‹¨',
                        recruit_title: 'ë””ì§€í„¸ ì „ë¬¸ì¸ë ¥ ì±„ìš©',
                        work_region: 'ì „êµ­',
                        recruit_person_cnt: '10',
                        inst_type_nm: 'ê³µë‹¨',
                        rcept_end_date: '2024-12-25',
                        reg_date: new Date().toISOString(),
                        status: 'active',
                        created_at: new Date(),
                        updated_at: new Date()
                    },
                    {
                        inst_nm: 'í•œêµ­ì² ë„ê³µì‚¬',
                        recruit_title: 'ì² ë„ ìš´ì˜ ì „ë¬¸ì§ ëª¨ì§‘',
                        work_region: 'ë¶€ì‚°',
                        recruit_person_cnt: '3',
                        inst_type_nm: 'ê³µì‚¬',
                        rcept_end_date: '2024-12-20',
                        reg_date: new Date().toISOString(),
                        status: 'active',
                        created_at: new Date(),
                        updated_at: new Date()
                    }
                ];
                
                const jobsRef = collection(db, 'recruitment_jobs');
                let addedCount = 0;
                
                for (const job of sampleJobs) {
                    await addDoc(jobsRef, job);
                    addedCount++;
                }
                
                showStatus('success', `âœ… ${addedCount}ê°œì˜ ìƒ˜í”Œ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
                setTimeout(() => {
                    testConnection();
                }, 1000);
                
            } catch (error) {
                console.error('ìƒ˜í”Œ ë°ì´í„° ìƒì„± ì‹¤íŒ¨:', error);
                showStatus('error', `âŒ ìƒ˜í”Œ ë°ì´í„° ìƒì„± ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // ì—°ê²° í…ŒìŠ¤íŠ¸
        window.testConnection = async function() {
            const config = {
                apiKey: document.getElementById('apiKey').value,
                authDomain: document.getElementById('authDomain').value,
                projectId: document.getElementById('projectId').value,
                storageBucket: document.getElementById('storageBucket').value,
                messagingSenderId: document.getElementById('messagingSenderId').value,
                appId: document.getElementById('appId').value
            };
            
            if (!config.apiKey) {
                showStatus('error', 'âŒ API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                showStatus('info', 'ğŸ”„ Firebase ì´ˆê¸°í™” ì¤‘...');
                
                // ê¸°ì¡´ ì•±ì´ ìˆìœ¼ë©´ ì‚­ì œ
                if (app) {
                    await app.delete();
                }
                
                // Firebase ì´ˆê¸°í™”
                app = initializeApp(config);
                db = getFirestore(app);
                
                showStatus('success', 'âœ… Firebase ì—°ê²° ì„±ê³µ!');
                
                // Firestore í…ŒìŠ¤íŠ¸
                showStatus('info', 'ğŸ”„ Firestore ë°ì´í„° ì¡°íšŒ ì¤‘...');
                
                try {
                    // recruitment_jobs ì»¬ë ‰ì…˜ ì¡°íšŒ
                    const jobsRef = collection(db, 'recruitment_jobs');
                    const q = query(jobsRef, limit(20));
                    const snapshot = await getDocs(q);
                    
                    if (snapshot.empty) {
                        showStatus('info', 'ğŸ“­ recruitment_jobs ì»¬ë ‰ì…˜ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                        document.getElementById('dataDisplay').innerHTML = `
                            <div style="text-align: center; padding: 40px;">
                                <h3>ğŸ“­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                                <p>ìƒ˜í”Œ ë°ì´í„°ë¥¼ ìƒì„±í•˜ë ¤ë©´ ìœ„ì˜ "ğŸ“ ìƒ˜í”Œ ë°ì´í„° ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                            </div>
                        `;
                    } else {
                        showStatus('success', `âœ… Firestore ì—°ê²° ì„±ê³µ! ${snapshot.size}ê°œ ë¬¸ì„œ ë°œê²¬`);
                        
                        // ë°ì´í„° í‘œì‹œ
                        let html = '<h3>ğŸ“‹ ì±„ìš©ê³µê³  ë°ì´í„°</h3>';
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            html += `
                                <div class="job-item">
                                    <h3>${data.recruit_title || 'N/A'}</h3>
                                    <div class="meta">ğŸ›ï¸ <strong>ê¸°ê´€:</strong> ${data.inst_nm || 'N/A'}</div>
                                    <div class="meta">ğŸ“ <strong>ì§€ì—­:</strong> ${data.work_region || 'N/A'}</div>
                                    <div class="meta">ğŸ‘¥ <strong>ì¸ì›:</strong> ${data.recruit_person_cnt || 'N/A'}ëª…</div>
                                    <div class="meta">ğŸ’¼ <strong>ìœ í˜•:</strong> ${data.inst_type_nm || 'N/A'}</div>
                                    <div class="meta">ğŸ“… <strong>ë§ˆê°ì¼:</strong> ${data.rcept_end_date || 'N/A'}</div>
                                    <div class="meta">ğŸ”‘ <strong>ë¬¸ì„œ ID:</strong> ${doc.id}</div>
                                </div>
                            `;
                        });
                        document.getElementById('dataDisplay').innerHTML = html;
                    }
                    
                } catch (error) {
                    console.error('Firestore ì—ëŸ¬:', error);
                    if (error.code === 'permission-denied') {
                        showStatus('error', 'âŒ Firestore ê¶Œí•œ ê±°ë¶€. ë³´ì•ˆ ê·œì¹™ì„ í™•ì¸í•˜ì„¸ìš”.');
                    } else if (error.message.includes('index')) {
                        showStatus('error', 'âš ï¸ Firestore ì¸ë±ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì½˜ì†”ì—ì„œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì„¸ìš”.');
                    } else {
                        showStatus('error', `âŒ Firestore ì—ëŸ¬: ${error.message}`);
                    }
                }
                
            } catch (error) {
                console.error('Firebase ì´ˆê¸°í™” ì—ëŸ¬:', error);
                showStatus('error', `âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // ìƒíƒœ í‘œì‹œ
        function showStatus(type, message) {
            const statusEl = document.getElementById('status');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `${new Date().toLocaleTimeString()} - ${message}`;
            statusEl.appendChild(div);
            statusEl.scrollTop = statusEl.scrollHeight;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ì„¤ì • í™•ì¸
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('firebaseConfig_job_pubint');
            if (saved) {
                loadSavedConfig();
                showStatus('info', 'ğŸ’¾ ì €ì¥ëœ ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. "ì—°ê²° í…ŒìŠ¤íŠ¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
            } else {
                showStatus('info', 'ğŸ“ Firebase ì„¤ì •ê°’ì„ ì…ë ¥í•œ í›„ "ì—°ê²° í…ŒìŠ¤íŠ¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
            }
        });
    </script>
</body>
</html>